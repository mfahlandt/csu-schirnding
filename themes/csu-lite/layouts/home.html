{{ define "main" }}

{{/* Hero Section - Full Width */}}
<section class="hero" style="background-image: url('{{ .Site.Params.heroImage | relURL }}');">
    <div class="container py-5 text-center position-relative">
        <h1 class="display-4 fw-bold">{{ .Site.Params.homepage.heroTitle | default .Site.Title }}</h1>
        <p class="lead mb-4">{{ .Site.Params.homepage.heroSubtitle | default .Site.Params.description }}</p>

        {{/* Upcoming Events Box */}}
        <div class="row justify-content-center mt-5">
            <div class="col-lg-8">
                <div class="card text-start shadow">
                    <div class="card-header bg-csu-blue text-white text-uppercase fw-bold">
                        <i class="far fa-calendar-alt me-2"></i>Nächste Termine
                    </div>
                    <ul class="list-group list-group-flush">
                        {{ $today := now.Format "2006-01-02" | time }}
                        {{ $sortedTermine := (where .Site.RegularPages "Type" "termine").ByParam "event_date" }}
                        {{ $upcoming := slice }}
                        {{ range $sortedTermine }}
                            {{ if ge (.Params.event_date | time) $today }}
                                {{ $upcoming = $upcoming | append . }}
                            {{ end }}
                        {{ end }}

                        {{ range first 3 $upcoming }}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <a href="{{ .Permalink }}" class="text-decoration-none text-dark fw-bold">{{ .Title }}</a>
                                <br>
                                <small class="text-muted">{{ .Params.location }}</small>
                            </div>
                            <span class="badge bg-csu-blue rounded-pill">{{ (.Params.event_date | time).Format "02. Jan" }}</span>
                        </li>
                        {{ else }}
                        <li class="list-group-item text-muted">Zurzeit sind keine Termine geplant.</li>
                        {{ end }}
                    </ul>
                    <div class="card-footer text-center">
                        <a href="/termine" class="btn btn-outline-csu-blue btn-sm">Alle Termine anzeigen</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

{{/* Kommunalwahl Störer */}}
{{ with .Site.Params.kommunalwahlStoererLink }}
<a href="{{ . | relURL }}" class="kommunalwahl-stoerer">
    <span>{{ $.Site.Params.kommunalwahlStoererText }}</span>
    <strong>{{ $.Site.Params.kommunalwahlStoererHighlight }}</strong>
</a>
{{ end }}

{{/* Feature Tiles Section */}}
<section class="py-5">
    <div class="container">
        <div class="row g-4">
            <div class="col-md-6">
                {{ partial "feature_tile.html" (dict "badge_text" "Live" "badge_class" "bg-danger" "title" "CSU-Parteitag" "content" "Verfolgen Sie den CSU-Parteitag live aus München und seien Sie bei den wichtigsten Entscheidungen dabei." "url" "#" "link_text" "Zum Livestream") }}
            </div>
            <div class="col-md-6">
                {{ partial "feature_tile.html" (dict "badge_text" "Aktuell" "title" "Neues aus Schirnding" "content" "Lesen Sie die neuesten Nachrichten und Berichte aus unserem Ortsverband und der Marktgemeinde." "url" "/aktuelles" "link_text" "Zu den Meldungen") }}
            </div>
        </div>
    </div>
</section>

{{/* Aktuelles Section */}}
<section class="py-5 bg-light">
    <div class="container">
        <div class="row mb-4">
            <div class="col-12 text-center">
                <h2 class="text-csu-blue text-uppercase fw-bold">{{ .Site.Params.homepage.newsTitle | default "Aktuelles" }}</h2>
                <div style="height: 4px; width: 60px; background: var(--csu-blue); margin: 10px auto;"></div>
            </div>
        </div>
        <div class="row g-4">
            {{ range first 3 (where .Site.RegularPages "Type" "aktuelles") }}
            <div class="col-lg-4 col-md-6">
                <div class="card h-100">
                    {{ if .Params.image }}
                    <img src="{{ .Params.image | relURL }}" class="card-img-top" alt="{{ .Title }}" style="height: 200px; object-fit: cover;">
                    {{ end }}
                    <div class="card-body d-flex flex-column">
                        <small class="text-muted mb-2">{{ .Date.Format "02. Januar 2006" }}</small>
                        <h5 class="card-title">{{ .Title }}</h5>
                        <p class="card-text text-muted flex-grow-1">{{ .Summary | truncate 120 }}</p>
                        <a href="{{ .Permalink }}" class="text-csu-blue fw-bold text-decoration-none mt-3">Weiterlesen &rarr;</a>
                    </div>
                </div>
            </div>
            {{ end }}
        </div>
    </div>
</section>

{{/* Team Section */}}
<section class="py-5">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-6">
                <h3 class="fw-bold">{{ .Site.Params.homepage.teamTitle | default "Unsere Köpfe" }}</h3>
                <p>{{ .Site.Params.homepage.teamSubtitle | default "Lernen Sie unser Team kennen." }}</p>
                <a href="/vorstand" class="btn btn-csu">{{ .Site.Params.homepage.teamButtonText | default "Zum Team" }}</a>
            </div>
            <div class="col-md-6 text-center">
                {{ with .Site.Params.homepage.teamImage }}
                <img src="{{ . | relURL }}" class="img-fluid rounded-circle shadow-sm" alt="{{ $.Site.Params.homepage.teamImageAlt | default "CSU Team" }}" style="max-width: 300px;">
                {{ else }}
                <img src="https://via.placeholder.com/300x300.png?text=Team+Bild" class="img-fluid rounded-circle shadow-sm" alt="{{ $.Site.Params.homepage.teamImageAlt | default "CSU Team" }}" style="max-width: 300px;">
                {{ end }}
            </div>
        </div>
    </div>
</section>

{{ end }}
